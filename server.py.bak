from scapy.all import *
from threading import Thread
import sys
import os.path

class TFTPAgent:
	def __init__(self, sport):
		self.sport = sport

	def create_server(self, pkt):
		src = pkt[IP].dst
		dst = pkt[IP].src
		dport = pkt[UDP].sport
		serv = TFTPServer(src, dst, self.sport, dport)
		t = threading.Thread(target=serv.listen)
		t.start()

	def sniff_filter(self, pkt):
		return pkt.haslayer(UDP) and pkt[UDP].dport == self.sport 

	def run(self):
		sniff(prn=self.create_server, lfilter=self.sniff_filter)


class TFTPServer:
	def __init__(self, src, dst, sport, dport):
		self.src = src
		self.dst = dst
		self.sport = sport
		self.dport = dport
